<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>测试弹窗问题 - 修复版</title>
  <style>
    :root {
      --modal-z: 2000;
      --mask-z: 1999;
      --radius: 12px;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC",
      "Hiragino Sans GB", "Microsoft YaHei", "Helvetica Neue", Arial, sans-serif; }

    /* 打开弹窗时锁背景滚动 */
    body.modal-open { overflow: hidden; }

    /* ===== 遮罩：固定定位覆盖全屏 ===== */
    .modal-mask {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
      z-index: var(--mask-z);
      display: none;
    }
    .modal-mask.is-open { display: block; }

    /* ===== 弹窗容器：固定定位，grid 居中，避免受父容器影响 ===== */
    .modal-wrap {
      position: fixed;
      inset: 0;
      z-index: var(--modal-z);
      display: none;

      /* 居中 */
      display: grid;
      place-items: center;

      /* 小屏留白 */
      padding: 24px 16px;
    }
    .modal-wrap.is-open { display: grid; }

    /* ===== 弹窗主体 ===== */
    .modal {
      width: min(980px, 100%);
      background: #fff;
      border-radius: var(--radius);
      box-shadow: 0 18px 60px rgba(0, 0, 0, 0.25);
      overflow: hidden; /* 保证圆角 */
      outline: none;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      border-bottom: 1px solid #eee;
      background: #fff;
    }

    .modal-title {
      font-size: 16px;
      font-weight: 700;
      margin: 0;
    }

    .modal-close {
      border: none;
      background: transparent;
      font-size: 22px;
      line-height: 1;
      cursor: pointer;
      padding: 6px 10px;
      border-radius: 10px;
    }
    .modal-close:hover { background: #f3f3f3; }

    /* 关键：内容区最大高度 + 滚动，防止弹窗撑出屏幕 */
    .modal-body {
      max-height: calc(100vh - 160px);
      overflow: auto;
      padding: 16px;
      background: #fff;
    }

    .modal-footer {
      padding: 12px 16px;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      background: #fff;
    }

    .btn {
      border: 1px solid #ddd;
      background: #fff;
      padding: 8px 12px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn:hover { background: #f7f7f7; }
    .btn.primary {
      border-color: #2f7dff;
      background: #2f7dff;
      color: #fff;
    }
    .btn.primary:hover { filter: brightness(0.95); }

    /* ====== 以下是示例页面内容（你可以删掉/替换成你的列表页） ====== */
    .page {
      padding: 20px;
    }
    .hint {
      margin-top: 10px;
      color: #666;
      font-size: 13px;
    }
    .fake-layout {
      margin-top: 16px;
      display: grid;
      grid-template-columns: 220px 1fr 260px;
      gap: 16px;
      min-height: 600px;
    }
    .card {
      border: 1px solid #e7e7e7;
      border-radius: 12px;
      background: #fff;
      padding: 12px;
      min-height: 200px;
    }
    .card-title {
      font-weight: 700;
      margin: 0 0 8px 0;
      font-size: 14px;
    }
    .long {
      height: 1200px;
      background: linear-gradient(#fafafa, #f0f0f0);
      border-radius: 12px;
      border: 1px dashed #ddd;
    }

    /* 小屏适配 */
    @media (max-width: 900px) {
      .fake-layout { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <!-- ===== 示例页面 ===== -->
  <div class="page">
    <button class="btn primary" id="openBtn">打开弹窗</button>
    <div class="hint">
      修复点：弹窗/遮罩挂到 body（不放在列表容器里），fixed 居中，内容区滚动，z-index 提高。
    </div>

    <div class="fake-layout">
      <div class="card">
        <p class="card-title">左侧筛选</p>
        <div class="long"></div>
      </div>
      <div class="card">
        <p class="card-title">中间列表</p>
        <div class="long"></div>
      </div>
      <div class="card">
        <p class="card-title">右侧信息</p>
        <div class="long"></div>
      </div>
    </div>
  </div>

  <!-- ===== 遮罩（直接放 body 下） ===== -->
  <div class="modal-mask" id="modalMask"></div>

  <!-- ===== 弹窗（直接放 body 下） ===== -->
  <div class="modal-wrap" id="modalWrap" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" tabindex="-1" id="modalPanel">
      <div class="modal-header">
        <h3 class="modal-title">测试弹窗</h3>
        <button class="modal-close" id="closeBtn" aria-label="关闭">×</button>
      </div>

      <div class="modal-body" id="modalBody">
        <!-- ✅ 把你原来弹窗里的“联通/电信/手机号输入/表单”等内容，直接粘贴到这里即可 -->

        <h4 style="margin:0 0 12px 0;">这里放你的弹窗表单内容</h4>

        <div style="display:grid; gap:12px;">
          <div style="border:1px solid #eee; border-radius:12px; padding:12px;">
            <strong>联通</strong>
            <div style="margin-top:10px;">
              <label>消息内容</label>
              <textarea style="width:100%; min-height:100px; margin-top:6px; border:1px solid #ddd; border-radius:10px; padding:8px;"></textarea>
            </div>
          </div>

          <div style="border:1px solid #eee; border-radius:12px; padding:12px;">
            <strong>电信</strong>
            <div style="margin-top:10px;">
              <label>消息内容</label>
              <textarea style="width:100%; min-height:260px; margin-top:6px; border:1px solid #ddd; border-radius:10px; padding:8px;"></textarea>
            </div>
          </div>

          <div style="height: 700px; border:1px dashed #ddd; border-radius:12px; padding:12px; background:#fafafa;">
            模拟长内容：内容很多时只滚动这个区域，弹窗不会超出屏幕。
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn" id="cancelBtn">取消</button>
        <button class="btn primary" id="okBtn">确认</button>
      </div>
    </div>
  </div>

  <script>
    const wrap = document.getElementById('modalWrap');
    const mask = document.getElementById('modalMask');
    const openBtn = document.getElementById('openBtn');
    const closeBtn = document.getElementById('closeBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const okBtn = document.getElementById('okBtn');
    const panel = document.getElementById('modalPanel');

    function openModal() {
      document.body.classList.add('modal-open');
      wrap.classList.add('is-open');
      mask.classList.add('is-open');
      wrap.setAttribute('aria-hidden', 'false');

      // 聚焦弹窗，方便 ESC 关闭 / 可访问性
      setTimeout(() => panel.focus(), 0);
    }

    function closeModal() {
      document.body.classList.remove('modal-open');
      wrap.classList.remove('is-open');
      mask.classList.remove('is-open');
      wrap.setAttribute('aria-hidden', 'true');
    }

    openBtn.addEventListener('click', openModal);
    closeBtn.addEventListener('click', closeModal);
    cancelBtn.addEventListener('click', closeModal);
    okBtn.addEventListener('click', () => {
      // TODO: 这里写你的确认逻辑
      closeModal();
    });

    // 点击遮罩关闭
    mask.addEventListener('click', closeModal);

    // ESC 关闭
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && wrap.classList.contains('is-open')) {
        closeModal();
      }
    });

    // 阻止点击弹窗内部时冒泡到遮罩（如果你把点击关闭绑定在 wrap 上时需要）
    // 这里我们绑定在 mask 上了，所以只是示例备用：
    // panel.addEventListener('click', (e) => e.stopPropagation());
  </script>
</body>
</html>
